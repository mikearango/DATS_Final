---
title: "Final Project Regression Models"
author: "Jack Crum"
date: "April 26, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# setwd("C:/Users/JackCrum/Documents/GitHub/DATS_Final/DATS_Final")
df <- read.csv("../cleaned_housing.csv")

train <- read.csv("../train_housing.csv")
test <- read.csv("../test_housing.csv")

test_y <- test[, "saleprice"]

i <- sapply(df, is.factor)
df[i] <- lapply(df[i], as.integer)

i <- sapply(train, is.factor)
train[i] <- lapply(train[i], as.integer)

i <- sapply(test, is.factor)
test[i] <- lapply(test[i], as.integer)
```

```{r}
df$garage.yr.blt <- as.character(df$garage.yr.blt)
index.garage.yr.blt <- which(is.na(df$garage.yr.blt))
df[index.garage.yr.blt, 'garage.yr.blt'] <- 'No Garage'
df$garage.yr.blt <- as.factor(df$garage.yr.blt)
```

```{r}
any(is.na(df))
sum(is.na(df))
```

```{r Kitchen Sink Model}
all.model <- lm(saleprice ~ ., data = train)
summary(all.model)

pred.all <- predict(all.model, test)
RMSE.all <- sqrt(mean((pred.all - test_y)^2))
RMSE.all
```

```{r Model 2}
model.2 <- lm(saleprice ~ ms.zoning + lot.area + street + land.contour + land.slope + neighborhood + condition.1 + condition.2 + bldg.type + house.style + overall.qual + overall.cond + year.built + roof.style + exterior.1st + exterior.2nd + mas.vnr.type + mas.vnr.area + exter.qual + bsmt.qual + bsmt.exposure + bsmtfin.sf.1 + bsmtfin.sf.2 + bsmt.unf.sf + heating.qc + x1st.flr.sf + x2nd.flr.sf + bsmt.full.bath + bsmt.half.bath + full.bath + bedroom.abvgr + functional + fireplaces + fireplace.qu + garage.yr.blt + garage.cars + garage.area + wood.deck.sf + enclosed.porch + screen.porch + misc.feature + sale.type + sale.condition + ln.lot.frontage + ln.lot.area, data = train)
summary(model.2)

pred.2 <- predict(model.2, test)
RMSE.2 <- sqrt(mean((pred.2 - test_y)^2))
RMSE.2
```

```{r Model 3}
model.3 <- lm(saleprice ~ overall.qual + neighborhood + bldg.type + bsmt.qual + total.bsmt.sf + gr.liv.area + full.bath + half.bath + totrms.abvgrd + kitchen.qual + garage.qual + wood.deck.sf + screen.porch + misc.feature, data = train)

pred.3 <- predict(model.3, test)
RMSE.3 <- sqrt(mean((pred.3 - test_y)^2))
RMSE.3
```

```{r Model Simple}
model.4 <- lm(saleprice ~ overall.qual + total.bsmt.sf + gr.liv.area + full.bath + totrms.abvgrd, data = train)
pred.4 <- predict(model.4, test)
RMSE.4 <- sqrt(mean((pred.4 - test_y)^2))
RMSE.4
```

```{r Model Very Simple}
model.5 <- lm(saleprice ~ overall.qual + gr.liv.area, data = train)
pred.5 <- predict(model.5, test)
RMSE.5 <- sqrt(mean((pred.5 - test_y)^2))
RMSE.5
```

```{r Stepwise Backward}
step.back.model <- step(all.model, direction = "backward")

summary(step.back.model)
pred.test.back <- predict(step.back.model, newdata = test)
RMSE.back <- sqrt(mean((pred.test.back - test_y)^2))
RMSE.back
```

```{r Stepwise Forward}
step.forward.model <- step(all.model, direction = "forward")

summary(step.forward.model)
pred.test.forward <- predict(step.forward.model, newdata = test)
RMSE.forward <- sqrt(mean((pred.test.forward - test_y)^2))
RMSE.forward
```

```{r Decision Tree}
library(tree)

tree_model <- tree(saleprice ~ ., data = train)
tree_model

plot(tree_model)
text(tree_model, pretty = 0)

tree_pred <- predict(tree_model, test)
RMSE.tree <- sqrt(mean((tree_pred - test_y)^2))
RMSE.tree

cv_tree <- cv.tree(tree_model)
plot(cv_tree$size, cv_tree$dev, type = "b", xlab = "Tree Size", ylab = "MSE")

cv_tree$size[1]

pruned_model <- prune.tree(tree_model, best = 10)
plot(pruned_model)
text(pruned_model)

pruned_pred <- predict(pruned_model, test)
RMSE.pruned <- sqrt(mean((pruned_pred - test_y)^2))
RMSE.pruned

tree.lm.model <- lm(saleprice ~ overall.qual + gr.liv.area + bsmt.qual + total.bsmt.sf + x1st.flr.sf, data = train)
tree.lm.pred <- predict(tree.lm.model, test)
RMSE.tree.lm <- sqrt(mean((tree.lm.pred - test_y) ^ 2))
RMSE.tree.lm

RMSE.pruned - RMSE.tree.lm
```
